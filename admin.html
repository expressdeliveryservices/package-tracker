<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Express Delivery</title>
<style>
body{font-family:Arial,sans-serif;background:#f0f2f5;color:#000;margin:0;padding:0;}
header{background:#1e90ff;color:white;padding:15px;text-align:center;}
.container{max-width:1000px;margin:20px auto;padding:20px;background:white;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
input,textarea,select,button{margin:5px 0;padding:8px;width:100%;border-radius:3px;border:1px solid #ccc;font-size:14px;}
input[readonly]{background:#e0e0e0;cursor:not-allowed;}
button{background:#1e90ff;color:white;border:none;cursor:pointer;}
button:hover{background:#1565c0;}
h2,h3{color:#1e90ff;margin-top:0;}
.section{margin-bottom:30px;}
label{font-weight:bold;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ddd;padding:8px;text-align:left;}
th{background:#1e90ff;color:white;}
.shipment-form div{margin-bottom:10px;}
#generateTrackingCode{background:#4CAF50;color:white;}
#signaturePreview img{max-width:100px;height:auto;margin-top:10px;border:1px solid #ddd;border-radius:3px;}
#signaturePreview p{font-size:12px;color:#555;}
#signedByGeoTrust{color:red;}
</style>
</head>
<body>

<header>
  <h1>Admin Dashboard</h1>
</header>

<div class="container">

  <!-- Login Section -->
  <div class="section" id="loginSection">
    <h2>Login</h2>
    <label>Email:</label>
    <input type="email" id="adminEmail" placeholder="Enter admin email">
    <label>Password:</label>
    <input type="password" id="adminPassword" placeholder="Enter password">
    <button onclick="login()">Login</button>
    <p id="loginMessage" style="color:red;"></p>
  </div>

  <!-- Dashboard Section -->
  <div class="section" id="dashboardSection" style="display:none;">
    
    <h2>Edit Newsletter Subscribers</h2>
    <textarea id="newsletterList" rows="5" placeholder="One email per line"></textarea>
    <button onclick="saveNewsletter()">Save Newsletter</button>

    <h2>Edit Customer Reviews</h2>
    <textarea id="reviewsList" rows="5" placeholder="One review per line"></textarea>
    <button onclick="saveReviews()">Save Reviews</button>

    <h2>Upload Signature Stamp</h2>
    <div class="section">
      <label>Signature Stamp Image:</label>
      <input type="file" id="signatureStamp" accept="image/*">
      <div id="signaturePreview"></div>
      <button onclick="saveSignatureStamp()">Save Signature Stamp</button>
    </div>

    <h2>Generate New Tracking Code</h2>
    <div class="shipment-form">
      <input type="text" id="newTrackingNumber" placeholder="New Tracking Code will be generated" readonly>
      <div>
        <label>Amount ($):</label>
        <input type="number" id="newShipmentAmount" step="0.01" placeholder="Shipment Amount" required>
      </div>
      <div>
        <label>Order ID:</label>
        <input type="text" id="newOrderId" placeholder="Order ID" required>
      </div>
      <div>
        <label>Est. Delivery Date:</label>
        <input type="date" id="newEstDeliveryDate" placeholder="Estimated Delivery Date" required>
      </div>
      <div>
        <label>Payment Mode:</label>
        <input type="text" id="newPaymentMode" value="Online Payment" readonly>
      </div>
      <div>
        <label>Mode of Transport:</label>
        <input type="text" id="newModeOfTransport" placeholder="Mode of Transport" required>
      </div>
      <div>
        <label>Type of Shipment:</label>
        <input type="text" id="newTypeOfShipment" placeholder="Type of Shipment" required>
      </div>
      <div>
        <label>Quantity:</label>
        <input type="text" id="newQuantity" placeholder="Quantity" required>
      </div>
      <div>
        <label>Official Stamp Date:</label>
        <input type="date" id="newOfficialStampDate" placeholder="Official Stamp Date" required>
      </div>
      <div>
        <label>Payment Method:</label>
        <input type="text" id="newPaymentMethod" value="Visa and PayPal" readonly>
      </div>
      <div>
        <label>Signed by:</label>
        <input type="text" id="newSignedByGeoTrust" value="GeoTrust" readonly style="color:red;">
      </div>
      <div>
        <label>Content:</label>
        <input type="text" id="newShipmentContent" placeholder="Shipment Content" required>
      </div>
      <div>
        <label>Origin:</label>
        <input type="text" id="newShipmentOrigin" placeholder="Origin Area" required>
      </div>
      <div>
        <label>Destination:</label>
        <input type="text" id="newShipmentDestination" placeholder="Destination Area" required>
      </div>
      <h3>Sender Details</h3>
      <div>
        <label>Name:</label>
        <input type="text" id="newSenderName" placeholder="Sender Name" required>
      </div>
      <div>
        <label>Address:</label>
        <input type="text" id="newSenderAddress" placeholder="Sender Address" required>
      </div>
      <h3>Receiver Details</h3>
      <div>
        <label>Name:</label>
        <input type="text" id="newReceiverName" placeholder="Receiver Name" required>
      </div>
      <div>
        <label>Address:</label>
        <input type="text" id="newReceiverAddress" placeholder="Receiver Address" required>
      </div>
      <div>
        <label>Mobile:</label>
        <input type="text" id="newReceiverMobile" placeholder="Receiver Mobile" required>
      </div>
      <div>
        <label>Latitude:</label>
        <input type="number" id="newReceiverLat" step="0.0001" placeholder="Receiver Latitude" required>
      </div>
      <div>
        <label>Longitude:</label>
        <input type="number" id="newReceiverLng" step="0.0001" placeholder="Receiver Longitude" required>
      </div>
      <h3>Timeline</h3>
      <textarea id="newTimeline" rows="4" placeholder='Enter timeline events as JSON array (e.g., [{"time":"22 Sep 2025 12:33","description":"✅ Item shipped","status":"IN TRANSIT","completed":true}])' required></textarea>
      <button id="generateTrackingCode" onclick="generateTrackingCode()">Generate Tracking Code</button>
      <p>Send the generated tracking code to the recipient. They can use it on the public page to view details anytime.</p>
    </div>

    <h2>Edit Shipments</h2>
    <div class="shipment-form">
      <input type="text" id="trackingNumber" value="ZWB-208345675" placeholder="Tracking Number" readonly>
      <div>
        <label>Amount ($):</label>
        <input type="number" id="shipmentAmount" step="0.01" value="0.00" placeholder="Shipment Amount">
      </div>
      <div>
        <label>Order ID:</label>
        <input type="text" id="orderId" value="" placeholder="Order ID">
      </div>
      <div>
        <label>Est. Delivery Date:</label>
        <input type="date" id="estDeliveryDate" placeholder="Estimated Delivery Date">
      </div>
      <div>
        <label>Payment Mode:</label>
        <input type="text" id="paymentMode" value="Online Payment" readonly>
      </div>
      <div>
        <label>Mode of Transport:</label>
        <input type="text" id="modeOfTransport" placeholder="Mode of Transport">
      </div>
      <div>
        <label>Type of Shipment:</label>
        <input type="text" id="typeOfShipment" placeholder="Type of Shipment">
      </div>
      <div>
        <label>Quantity:</label>
        <input type="text" id="quantity" placeholder="Quantity">
      </div>
      <div>
        <label>Official Stamp Date:</label>
        <input type="date" id="officialStampDate" placeholder="Official Stamp Date">
      </div>
      <div>
        <label>Payment Method:</label>
        <input type="text" id="paymentMethod" value="Visa and PayPal" readonly>
      </div>
      <div>
        <label>Signed by:</label>
        <input type="text" id="signedByGeoTrust" value="GeoTrust" readonly style="color:red;">
      </div>
      <div>
        <label>Content:</label>
        <input type="text" id="shipmentContent" value="Package" placeholder="Shipment Content">
      </div>
      <div>
        <label>Origin:</label>
        <input type="text" id="shipmentOrigin" value="London UK" placeholder="Origin Area">
      </div>
      <div>
        <label>Destination:</label>
        <input type="text" id="shipmentDestination" value="Russia" placeholder="Destination Area">
      </div>
      <h3>Sender Details</h3>
      <div>
        <label>Name:</label>
        <input type="text" id="senderName" value="James" placeholder="Sender Name">
      </div>
      <div>
        <label>Address:</label>
        <input type="text" id="senderAddress" value="London UK" placeholder="Sender Address">
      </div>
      <h3>Receiver Details</h3>
      <div>
        <label>Name:</label>
        <input type="text" id="receiverName" value="Podvezennaya Elena Ivanovna" placeholder="Receiver Name">
      </div>
      <div>
        <label>Address:</label>
        <input type="text" id="receiverAddress" value="195299 St. Petersburg, Prosveshcheniya Avenue 104, Apt. 281" placeholder="Receiver Address">
      </div>
      <div>
        <label>Mobile:</label>
        <input type="text" id="receiverMobile" value="+79932195775" placeholder="Receiver Mobile">
      </div>
      <div>
        <label>Latitude:</label>
        <input type="number" id="receiverLat" step="0.0001" value="59.9741" placeholder="Receiver Latitude">
      </div>
      <div>
        <label>Longitude:</label>
        <input type="number" id="receiverLng" step="0.0001" value="30.3232" placeholder="Receiver Longitude">
      </div>
      <h3>Timeline</h3>
      <textarea id="timeline" rows="4" placeholder="Enter timeline events as JSON array (e.g., [{&quot;time&quot;:&quot;22 Sep 2025 12:33&quot;,&quot;description&quot;:&quot;✅ Item arrived&quot;,&quot;status&quot;: &quot;ON HOLD&quot;,&quot;completed&quot;:true}])">[
  {"time":"23 Sep 2025 07:30","description":"✅ Item has arrived at Vnukovo International Airport, Russia","status":"ON HOLD","completed":true},
  {"time":"22 Sep 2025 14:00","description":"☑️ Your item is on its way to Russia, London UK","status":"IN TRANSIT","completed":true}
]</textarea>
      <button onclick="saveShipment()">Save Shipment</button>
    </div>

    <button style="background:red;margin-top:15px;" onclick="logout()">Logout</button>
  </div>

</div>

<script>
// Admin Credentials
const ADMIN_EMAIL = "Expressdeliveryservice0016@gmail.com";
const ADMIN_PASSWORD = "Umuojima";
const COMPANY_NAME = "Express Delivery Service";

// Login Function
function login(){
  const email = document.getElementById('adminEmail').value.trim();
  const pass = document.getElementById('adminPassword').value.trim();
  if(email === ADMIN_EMAIL && pass === ADMIN_PASSWORD){
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('dashboardSection').style.display = 'block';
    loadData();
  } else {
    document.getElementById('loginMessage').innerText = "Invalid email or password!";
  }
}

// Logout Function
function logout(){
  document.getElementById('loginSection').style.display = 'block';
  document.getElementById('dashboardSection').style.display = 'none';
  document.getElementById('adminEmail').value = '';
  document.getElementById('adminPassword').value = '';
  document.getElementById('loginMessage').innerText = '';
}

// Load existing data from localStorage
function loadData(){
  const newsletter = localStorage.getItem('newsletterEmails') || '';
  const reviews = localStorage.getItem('customerReviews') || '';
  const shipments = localStorage.getItem('shipments') || '[]';
  document.getElementById('newsletterList').value = newsletter.split(',').join('\n');
  document.getElementById('reviewsList').value = reviews.split('|').join('\n');
  const shipment = JSON.parse(shipments).find(s => s.trackingNumber === "ZWB-208345675");
  if(shipment){
    document.getElementById('shipmentAmount').value = shipment.receipt?.amount || '0.00';
    document.getElementById('orderId').value = shipment.receipt?.orderId || '';
    document.getElementById('estDeliveryDate').value = shipment.receipt?.estDeliveryDate || '';
    document.getElementById('modeOfTransport').value = shipment.receipt?.modeOfTransport || '';
    document.getElementById('typeOfShipment').value = shipment.receipt?.typeOfShipment || '';
    document.getElementById('quantity').value = shipment.receipt?.quantity || '';
    document.getElementById('officialStampDate').value = shipment.receipt?.officialStampDate || '';
    document.getElementById('shipmentContent').value = shipment.content || '';
    document.getElementById('shipmentOrigin').value = shipment.origin || '';
    document.getElementById('shipmentDestination').value = shipment.destination || '';
    document.getElementById('senderName').value = shipment.sender.name || '';
    document.getElementById('senderAddress').value = shipment.sender.address || '';
    document.getElementById('receiverName').value = shipment.receiver.name || '';
    document.getElementById('receiverAddress').value = shipment.receiver.address || '';
    document.getElementById('receiverMobile').value = shipment.receiver.mobile || '';
    document.getElementById('receiverLat').value = shipment.receiver.lat || 59.9741;
    document.getElementById('receiverLng').value = shipment.receiver.lng || 30.3232;
    document.getElementById('timeline').value = JSON.stringify(shipment.timeline, null, 2) || '[]';
  }
  // Load signature stamp preview
  const signatureStamp = localStorage.getItem('signatureStamp');
  const preview = document.getElementById('signaturePreview');
  if(signatureStamp){
    preview.innerHTML = `<img src="${signatureStamp}" alt="Signature Stamp"><p>Current signature stamp</p>`;
  } else {
    preview.innerHTML = `<p>No signature stamp uploaded</p>`;
  }
}

// Save Signature Stamp
function saveSignatureStamp(){
  const fileInput = document.getElementById('signatureStamp');
  const preview = document.getElementById('signaturePreview');
  if(fileInput.files.length > 0){
    const file = fileInput.files[0];
    if(file.type.startsWith('image/') && file.size <= 2 * 1024 * 1024){ // Limit to 2MB
      const reader = new FileReader();
      reader.onload = function(e){
        const base64Image = e.target.result;
        localStorage.setItem('signatureStamp', base64Image);
        preview.innerHTML = `<img src="${base64Image}" alt="Signature Stamp"><p>Current signature stamp</p>`;
        alert("Signature stamp saved successfully!");
      };
      reader.readAsDataURL(file);
    } else {
      alert("Please upload a valid image file (max 2MB).");
    }
  } else {
    alert("Please select an image to upload.");
  }
}

// Save Functions
function saveNewsletter(){
  const emails = document.getElementById('newsletterList').value.split('\n').map(e => e.trim()).filter(Boolean);
  localStorage.setItem('newsletterEmails', emails.join(','));
  alert("Newsletter emails saved!");
}

function saveReviews(){
  const reviews = document.getElementById('reviewsList').value.split('\n').map(e => e.trim()).filter(Boolean);
  localStorage.setItem('customerReviews', reviews.join('|'));
  alert("Customer reviews saved!");
}

function saveShipment(){
  try {
    const shipment = {
      trackingNumber: document.getElementById('trackingNumber').value.trim(),
      content: document.getElementById('shipmentContent').value.trim(),
      origin: document.getElementById('shipmentOrigin').value.trim(),
      destination: document.getElementById('shipmentDestination').value.trim(),
      sender: {
        name: document.getElementById('senderName').value.trim(),
        address: document.getElementById('senderAddress').value.trim()
      },
      receiver: {
        name: document.getElementById('receiverName').value.trim(),
        address: document.getElementById('receiverAddress').value.trim(),
        mobile: document.getElementById('receiverMobile').value.trim(),
        lat: parseFloat(document.getElementById('receiverLat').value) || 59.9741,
        lng: parseFloat(document.getElementById('receiverLng').value) || 30.3232
      },
      timeline: JSON.parse(document.getElementById('timeline').value.trim()),
      receipt: {
        companyName: COMPANY_NAME,
        amount: parseFloat(document.getElementById('shipmentAmount').value) || 0.00,
        orderId: document.getElementById('orderId').value.trim(),
        estDeliveryDate: document.getElementById('estDeliveryDate').value.trim(),
        paymentMode: document.getElementById('paymentMode').value.trim(),
        modeOfTransport: document.getElementById('modeOfTransport').value.trim(),
        typeOfShipment: document.getElementById('typeOfShipment').value.trim(),
        quantity: document.getElementById('quantity').value.trim(),
        officialStampDate: document.getElementById('officialStampDate').value.trim(),
        paymentMethod: document.getElementById('paymentMethod').value.trim(),
        signedBy: document.getElementById('signedByGeoTrust').value.trim()
      }
    };
    let shipments = JSON.parse(localStorage.getItem('shipments') || '[]');
    const index = shipments.findIndex(s => s.trackingNumber === shipment.trackingNumber);
    if(index !== -1){
      shipments[index] = shipment;
    } else {
      shipments.push(shipment);
    }
    localStorage.setItem('shipments', JSON.stringify(shipments));
    alert("Shipment saved! The receiver location map on the public page will update with the new address.");
  } catch (e) {
    alert("Invalid data! Please check the timeline JSON or fields.");
  }
}

// Generate New Tracking Code
function generateTrackingCode(){
  try {
    const letters = String.fromCharCode(...Array(3).fill().map(() => 65 + Math.floor(Math.random() * 26)));
    const numbers = Math.floor(100000000 + Math.random() * 900000000).toString();
    const newTracking = `${letters}${numbers}`;

    const shipment = {
      trackingNumber: newTracking,
      content: document.getElementById('newShipmentContent').value.trim(),
      origin: document.getElementById('newShipmentOrigin').value.trim(),
      destination: document.getElementById('newShipmentDestination').value.trim(),
      sender: {
        name: document.getElementById('newSenderName').value.trim(),
        address: document.getElementById('newSenderAddress').value.trim()
      },
      receiver: {
        name: document.getElementById('newReceiverName').value.trim(),
        address: document.getElementById('newReceiverAddress').value.trim(),
        mobile: document.getElementById('newReceiverMobile').value.trim(),
        lat: parseFloat(document.getElementById('newReceiverLat').value),
        lng: parseFloat(document.getElementById('newReceiverLng').value)
      },
      timeline: JSON.parse(document.getElementById('newTimeline').value.trim()),
      receipt: {
        companyName: COMPANY_NAME,
        amount: parseFloat(document.getElementById('newShipmentAmount').value) || 0.00,
        orderId: document.getElementById('newOrderId').value.trim(),
        estDeliveryDate: document.getElementById('newEstDeliveryDate').value.trim(),
        paymentMode: document.getElementById('newPaymentMode').value.trim(),
        modeOfTransport: document.getElementById('newModeOfTransport').value.trim(),
        typeOfShipment: document.getElementById('newTypeOfShipment').value.trim(),
        quantity: document.getElementById('newQuantity').value.trim(),
        officialStampDate: document.getElementById('newOfficialStampDate').value.trim(),
        paymentMethod: document.getElementById('newPaymentMethod').value.trim(),
        signedBy: document.getElementById('newSignedByGeoTrust').value.trim()
      }
    };

    if(!shipment.content || !shipment.origin || !shipment.destination || !shipment.sender.name || !shipment.sender.address ||
       !shipment.receiver.name || !shipment.receiver.address || !shipment.receiver.mobile || isNaN(shipment.receiver.lat) ||
       isNaN(shipment.receiver.lng) || !shipment.timeline || shipment.timeline.length === 0 ||
       isNaN(shipment.receipt.amount) || !shipment.receipt.orderId || !shipment.receipt.estDeliveryDate ||
       !shipment.receipt.modeOfTransport || !shipment.receipt.typeOfShipment || !shipment.receipt.quantity ||
       !shipment.receipt.officialStampDate){
      throw new Error("All editable fields are required and must be valid.");
    }

    let shipments = JSON.parse(localStorage.getItem('shipments') || '[]');
    if(shipments.some(s => s.trackingNumber === newTracking)){
      throw new Error("Tracking code already exists. Please try again.");
    }
    shipments.push(shipment);
    localStorage.setItem('shipments', JSON.stringify(shipments));

    document.getElementById('trackingNumber').value = newTracking;
    document.getElementById('shipmentAmount').value = shipment.receipt.amount;
    document.getElementById('orderId').value = shipment.receipt.orderId;
    document.getElementById('estDeliveryDate').value = shipment.receipt.estDeliveryDate;
    document.getElementById('modeOfTransport').value = shipment.receipt.modeOfTransport;
    document.getElementById('typeOfShipment').value = shipment.receipt.typeOfShipment;
    document.getElementById('quantity').value = shipment.receipt.quantity;
    document.getElementById('officialStampDate').value = shipment.receipt.officialStampDate;
    document.getElementById('shipmentContent').value = shipment.content;
    document.getElementById('shipmentOrigin').value = shipment.origin;
    document.getElementById('shipmentDestination').value = shipment.destination;
    document.getElementById('senderName').value = shipment.sender.name;
    document.getElementById('senderAddress').value = shipment.sender.address;
    document.getElementById('receiverName').value = shipment.receiver.name;
    document.getElementById('receiverAddress').value = shipment.receiver.address;
    document.getElementById('receiverMobile').value = shipment.receiver.mobile;
    document.getElementById('receiverLat').value = shipment.receiver.lat;
    document.getElementById('receiverLng').value = shipment.receiver.lng;
    document.getElementById('timeline').value = JSON.stringify(shipment.timeline, null, 2);

    document.getElementById('newTrackingNumber').value = newTracking;
    alert(`New tracking code generated: ${newTracking}. Details loaded, and others can use it on the public page anytime without expiration.`);
  } catch (e) {
    alert(`Error: ${e.message}`);
  }
}

document.addEventListener('DOMContentLoaded', loadData);
</script>

</body>
</html>
