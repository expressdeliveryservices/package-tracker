<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Express Delivery Service</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f2f5; color: #333; }
header { background: #1e90ff; color: white; padding: 15px 20px; position: relative; }
.header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
.header-content h1 { margin: 0; font-size: 24px; }
.nav-links { display: flex; gap: 20px; }
.nav-links a { color: white; text-decoration: none; font-size: 16px; }
.nav-links a:hover { text-decoration: underline; }
.hamburger { display: none; flex-direction: column; cursor: pointer; }
.hamburger div { width: 25px; height: 3px; background: white; margin: 2px 0; }
@media (max-width: 768px) {
  .nav-links { display: none; flex-direction: column; position: absolute; top: 60px; left: 0; background: #1e90ff; width: 100%; padding: 10px 0; }
  .nav-links.active { display: flex; }
  .hamburger { display: flex; }
  .hamburger.open div:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
  .hamburger.open div:nth-child(2) { opacity: 0; }
  .hamburger.open div:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }
}
.container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
.hero { text-align: center; padding: 40px 20px; background: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
.hero h2 { color: #1e90ff; margin-top: 0; }
.hero input { padding: 10px; width: 200px; margin: 10px 5px; border: 1px solid #ccc; border-radius: 5px; }
.hero button { padding: 10px 20px; background: #1e90ff; color: white; border: none; border-radius: 5px; cursor: pointer; }
.hero button:hover { background: #1565c0; }
#shipmentTracking, #shipmentContent { display: none; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin: 20px 0; }
.header { font-size: 18px; font-weight: bold; color: #1e90ff; margin-bottom: 10px; }
.timeline { margin-top: 10px; }
.timeline-event { display: flex; align-items: flex-start; margin-bottom: 15px; position: relative; padding-left: 30px; }
.timeline-event .tick { width: 12px; height: 12px; background: #ccc; border-radius: 50%; position: absolute; left: 0; top: 5px; }
.timeline-event.completed .tick { background: #4CAF50; }
.timeline-event .time { font-size: 14px; font-weight: bold; min-width: 120px; }
.timeline-event .description { font-size: 14px; }
.timeline-event .description div { display: inline-block; }
#shipmentContent { position: relative; }
.watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); color: #a9a9a9; font-size: 40px; font-weight: bold; opacity: 0.3; z-index: 0; }
#shipmentContent .header { display: flex; justify-content: space-between; align-items: center; }
.company-name { font-size: 24px; font-weight: bold; color: #1e90ff; }
.logo img { height: 50px; }
.section-title { font-size: 18px; font-weight: bold; margin: 20px 0 10px; padding-bottom: 5px; border-bottom: 2px solid #1e90ff; }
.details { display: grid; grid-template-columns: 150px 1fr; gap: 10px; font-size: 16px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; }
.details label { font-weight: bold; color: #333; }
.details span { color: #555; }
.details img.signature-img { max-width: 100px; height: auto; vertical-align: middle; }
.details img.payment-img { max-width: 50px; height: auto; margin-top: 5px; }
.total { font-size: 18px; font-weight: bold; margin-top: 20px; text-align: right; color: #1e90ff; }
.footer { font-size: 12px; text-align: center; margin-top: 20px; color: #555; border-top: 1px solid #ddd; padding-top: 10px; }
.print-btn { display: block; margin: 20px auto; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
.print-btn:hover { background: #45a049; }
#receiverMap { margin: 20px 0; }
.testimonial-section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin: 20px 0; }
.testimonial-section h2 { color: #1e90ff; text-align: center; }
.testimonial-wall { display: flex; overflow: hidden; position: relative; width: 100%; }
.testimonial { min-width: 100%; padding: 20px; box-sizing: border-box; text-align: center; transition: transform 0.5s ease; }
.testimonial p { font-style: italic; margin: 0; }
.newsletter { background: #1e90ff; color: white; padding: 20px; text-align: center; border-radius: 8px; margin: 20px 0; }
.newsletter input { padding: 10px; width: 200px; margin: 10px 5px; border: none; border-radius: 5px; }
.newsletter button { padding: 10px 20px; background: white; color: #1e90ff; border: none; border-radius: 5px; cursor: pointer; }
.newsletter button:hover { background: #f0f0f0; }
.support-btn { position: fixed; bottom: 20px; right: 20px; background: #1e90ff; color: white; padding: 10px 20px; border-radius: 50px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
.support-btn:hover { background: #1565c0; }
.support-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 1000; width: 300px; }
.support-popup h3 { margin-top: 0; color: #1e90ff; }
.support-popup input, .support-popup textarea { width: 100%; margin: 10px 0; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
.support-popup button { padding: 8px 16px; background: #1e90ff; color: white; border: none; border-radius: 5px; cursor: pointer; }
.support-popup button:hover { background: #1565c0; }
.overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
</style>
</head>
<body>

<header>
  <div class="header-content">
    <h1>Express Delivery Service</h1>
    <div class="hamburger" onclick="toggleMenu()">
      <div></div><div></div><div></div>
    </div>
    <div class="nav-links" id="navLinks">
      <a href="#home">Home</a>
      <a href="#tracking">Tracking</a>
      <a href="#testimonials">Testimonials</a>
      <a href="#newsletter">Newsletter</a>
      <a href="admin.html">Admin</a>
    </div>
  </div>
</header>

<div class="container">
  <div class="hero" id="home">
    <h2>Track Your Package</h2>
    <input type="text" id="trackingNumber" placeholder="Enter Tracking Number">
    <button onclick="trackPackage()">Track</button>
  </div>

  <div id="shipmentTracking"></div>
  <div id="receiverMap"></div>
  <div id="shipmentContent"></div>

  <div class="testimonial-section" id="testimonials">
    <h2>What Our Customers Say</h2>
    <div class="testimonial-wall">
      <div class="testimonial"><p>"Fast and reliable delivery!"</p></div>
      <div class="testimonial"><p>"Best service I've used!"</p></div>
      <div class="testimonial"><p>"My package arrived on time!"</p></div>
    </div>
  </div>

  <div class="newsletter" id="newsletter">
    <h2>Stay Updated</h2>
    <input type="email" id="newsletterEmail" placeholder="Enter your email">
    <button onclick="subscribeNewsletter()">Subscribe</button>
  </div>
</div>

<div class="support-btn" onclick="openSupport()">Support</div>
<div class="overlay" id="overlay"></div>
<div class="support-popup" id="supportPopup">
  <h3>Contact Support</h3>
  <input type="text" id="supportName" placeholder="Your Name">
  <input type="email" id="supportEmail" placeholder="Your Email">
  <textarea id="supportMessage" rows="4" placeholder="Your Message"></textarea>
  <button onclick="closeSupport()">Submit</button>
</div>

<div id="google_translate_element" style="position: fixed; bottom: 20px; left: 20px;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
// Hamburger Menu
function toggleMenu() {
  const navLinks = document.getElementById('navLinks');
  navLinks.classList.toggle('active');
  const hamburger = document.querySelector('.hamburger');
  hamburger.classList.toggle('open');
}

// Newsletter
function subscribeNewsletter() {
  const email = document.getElementById('newsletterEmail').value.trim();
  if (!email) {
    alert('Please enter a valid email address.');
    return;
  }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    alert('Please enter a valid email format.');
    return;
  }
  let emails = localStorage.getItem('newsletterEmails') ? localStorage.getItem('newsletterEmails').split(',') : [];
  if (!emails.includes(email)) {
    emails.push(email);
    localStorage.setItem('newsletterEmails', emails.join(','));
    alert('Thank you! Updates will be sent to ' + email);
  } else {
    alert('This email is already subscribed.');
  }
}

// Support Popup
function openSupport() {
  document.getElementById('supportPopup').style.display = 'block';
  document.getElementById('overlay').style.display = 'block';
}
function closeSupport() {
  document.getElementById('supportPopup').style.display = 'none';
  document.getElementById('overlay').style.display = 'none';
}

// Google Translate
function googleTranslateElementInit() {
  new google.translate.TranslateElement({ pageLanguage: 'en' }, 'google_translate_element');
}

// Initialize Maps
function initMaps() {
  const receiverMap = document.getElementById('receiverMap');
  receiverMap.innerHTML = `<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2482.614141570908!2d30.4252616!3d60.0348099!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4696378b4b5b0d8d%3A0x7e9f5b8c6e8e8e8e!2sProspekt%20Prosveshcheniya%2C%20104%2C%20Sankt-Peterburg%2C%20Russia!5e0!3m2!1sen!2sus!4v1695296400000" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
}

// Testimonial Slide Animation
function rotateTestimonials() {
  const testimonialWall = document.querySelector('.testimonial-wall');
  const totalTestimonials = document.querySelectorAll('.testimonial').length;
  let currentIndex = 0;

  function showTestimonial(index) {
    testimonialWall.style.transform = `translateX(-${index * 100}%)`;
  }

  setInterval(() => {
    currentIndex = (currentIndex + 1) % totalTestimonials;
    showTestimonial(currentIndex);
  }, 5000);
}

// Tracking
function trackPackage() {
  const number = document.getElementById('trackingNumber').value.trim();
  const trackingDiv = document.getElementById('shipmentTracking');
  const contentDiv = document.getElementById('shipmentContent');
  const receiverMap = document.getElementById('receiverMap');

  if (!number) {
    alert('Please enter a tracking number.');
    return;
  }

  trackingDiv.style.display = 'block';
  trackingDiv.innerHTML = '<div class="header">Tracking...</div>';

  let shipments = [];
  try {
    shipments = JSON.parse(localStorage.getItem('shipments') || '[]');
  } catch (e) {
    console.error('Invalid shipments JSON:', e);
    trackingDiv.innerHTML = '<div class="header">Error retrieving shipment data.</div>';
    return;
  }

  const shipment = shipments.find(s => s.trackingNumber === number);
  if (shipment && shipment.receiver && shipment.receiver.lat && shipment.receiver.lng) {
    const address = encodeURIComponent(shipment.receiver.address);
    const mapUrl = `https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d${(1 / Math.cos(shipment.receiver.lat * Math.PI / 180) * 156543.03392 * Math.cos(shipment.receiver.lat * Math.PI / 180) / Math.pow(2, 15))}!2d${shipment.receiver.lng}!3d${shipment.receiver.lat}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0:0x0!2s${address}!5e0!3m2!1sen!2sus!4v1695296400000&markers=color:red%7C${shipment.receiver.lat},${shipment.receiver.lng}`;
    receiverMap.innerHTML = `<a href="https://www.google.com/maps?q=${shipment.receiver.lat},${shipment.receiver.lng}" target="_blank"><iframe src="${mapUrl}" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe></a>`;
  } else {
    receiverMap.innerHTML = `<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2482.614141570908!2d30.4252616!3d60.0348099!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4696378b4b5b0d8d%3A0x7e9f5b8c6e8e8e8e!2sProspekt%20Prosveshcheniya%2C%20104%2C%20Sankt-Peterburg%2C%20Russia!5e0!3m2!1sen!2sus!4v1695296400000" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
  }

  setTimeout(() => {
    if (shipment) {
      trackingDiv.innerHTML = '<div class="header">Tracking Shipment: ' + number + '</div>';
      if (shipment.timeline && shipment.timeline.length > 0) {
        trackingDiv.innerHTML += `<div class="timeline">
          ${shipment.timeline.map(event => `
            <div class="timeline-event ${event.completed ? 'completed' : ''}">
              <div class="tick"></div>
              <div class="time">${event.time}</div>
              <div class="description">${event.description} <div style="background:#ccc;padding:2px 5px;border-radius:3px;margin-top:3px;">${event.status}</div></div>
            </div>
          `).join('')}
        </div>`;
      } else {
        trackingDiv.innerHTML += '<div class="timeline"><div class="timeline-event"><div class="tick"></div><div class="description">No tracking status available.</div></div></div>';
      }
    } else {
      trackingDiv.innerHTML = '<div class="header">Invalid tracking number.</div>';
      contentDiv.style.display = 'none';
      receiverMap.innerHTML = '';
    }
  }, 5000);

  setTimeout(() => {
    contentDiv.style.display = 'block';
    if (shipment) {
      const companyName = shipment.receipt.companyName;
      const amount = shipment.receipt.amount.toFixed(2);
      contentDiv.innerHTML = `
        <div style="position:relative;">
          <div class="watermark">CERTIFIED TRUE COPY</div>
          <div class="header">
            <div class="company-name">${companyName}</div>
            <div class="logo">
              <img src="https://raw.githubusercontent.com/expressdeliveryservices/package-tracker/refs/heads/main/IMG_1855.jpeg" alt="Company Logo">
            </div>
          </div>
          <div class="section-title">Shipment Details</div>
          <div class="details">
            <label>Tracking Number:</label><span>${shipment.trackingNumber}</span>
            <label>Order ID:</label><span>${shipment.orderId}</span>
            <label>Content:</label><span>${shipment.content}</span>
            <label>Origin:</label><span>${shipment.origin}</span>
            <label>Destination:</label><span>${shipment.destination}</span>
            <label>Est. Delivery:</label><span>${shipment.estDeliveryDate}</span>
            <label>Mode of Transport:</label><span>${shipment.modeOfTransport}</span>
            <label>Type of Shipment:</label><span>${shipment.typeOfShipment}</span>
            <label>Quantity:</label><span>${shipment.quantity}</span>
          </div>
          <div class="section-title">Payment Details</div>
          <div class="details">
            <label>Amount:</label><span>$${amount}</span>
            <label>Payment Mode:</label><span>${shipment.paymentMode}</span>
            <img src="https://raw.githubusercontent.com/expressdeliveryservices/package-tracker/refs/heads/main/IMG_1860.jpeg" class="payment-img" alt="Payment Icon">
          </div>
          <div class="section-title">Sender Details</div>
          <div class="details">
            <label>Name:</label><span>${shipment.sender.name}</span>
            <label>Address:</label><span>${shipment.sender.address}</span>
          </div>
          <div class="section-title">Receiver Details</div>
          <div class="details">
            <label>Name:</label><span>${shipment.receiver.name}</span>
            <label>Address:</label><span>${shipment.receiver.address}</span>
            <label>Mobile:</label><span>${shipment.receiver.mobile}</span>
          </div>
          <div class="section-title">Authorization</div>
          <div class="details">
            <label>Stamp Date:</label><span>${shipment.officialStampDate}</span>
            ${shipment.officialStamp ? `<label>Stamp:</label><span><img src="${shipment.officialStamp}" class="signature-img" alt="Signature Stamp"></span>` : ''}
          </div>
          <div class="total">Total: $${amount}</div>
          <div class="footer">
            Express Delivery Service | Phone: +1 (941) 207-8626 | Email: Expressdeliveryservice0016@gmail.com<br>
            Issued: September 23, 2025, 10:05 AM WAT
          </div>
        </div>
        <button class="print-btn" onclick="printInvoice('${number}')">Print Invoice</button>`;
    } else {
      contentDiv.innerHTML = '<div class="header">No shipment found for this tracking number.</div>';
    }
  }, 10000);
}

// Print Invoice
function printInvoice(number) {
  let shipments = JSON.parse(localStorage.getItem('shipments') || '[]');
  const shipment = shipments.find(s => s.trackingNumber === number);
  if (!shipment) {
    alert('No shipment found for this tracking number.');
    return;
  }

  const companyName = shipment.receipt.companyName;
  const amount = shipment.receipt.amount.toFixed(2);
  const receiptContent = `
    <html>
    <head><title>Receipt - ${shipment.trackingNumber}</title>
    <style>
      body { font-family: 'Times New Roman', Times, serif; margin: 2mm; background: #fff; }
      .receipt { width: 70mm; margin: 0 auto; padding: 2mm; border: 1px solid #000; background: #fff; position: relative; border-radius: 3px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
      .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); color: #a9a9a9; font-size: 16px; font-weight: bold; opacity: 0.4; z-index: 0; }
      .header { font-size: 10px; font-weight: bold; margin-bottom: 2px; display: flex; justify-content: space-between; align-items: center; }
      .company-name { font-size: 10px; font-weight: bold; }
      .logo img { height: 25px; }
      .section-title { font-size: 9px; font-weight: bold; margin: 2px 0; padding-bottom: 1px; border-bottom: 1px solid #000; }
      .details { font-size: 7px; margin: 2px 0; line-height: 1.2; letter-spacing: 0.5px; padding: 3px; border: 1px solid #ddd; border-radius: 3px; }
      .details label { font-weight: bold; width: 90px; display: inline-block; }
      .details img { max-width: 50px; height: auto; margin-top: 2px; }
      .total { font-size: 9px; font-weight: bold; margin-top: 5px; padding-top: 2px; text-align: right; }
      .footer { font-size: 5px; text-align: center; margin-top: 5px; color: #555; }
      @media print { body { margin: 0; } .receipt { border: 1px solid #000; } }
    </style>
    </head>
    <body>
    <div class="receipt">
      <div class="watermark">CERTIFIED TRUE COPY</div>
      <div class="header">
        <div class="company-name">${companyName}</div>
        <div class="logo">
          <img src="https://raw.githubusercontent.com/expressdeliveryservices/package-tracker/refs/heads/main/IMG_1855.jpeg" alt="Company Logo">
        </div>
      </div>
      <div class="section-title">Shipment Details</div>
      <div class="details">
        <label>Tracking Number:</label><span>${shipment.trackingNumber}</span>
        <label>Order ID:</label><span>${shipment.orderId}</span>
        <label>Content:</label><span>${shipment.content}</span>
        <label>Origin:</label><span>${shipment.origin}</span>
        <label>Destination:</label><span>${shipment.destination}</span>
        <label>Est. Delivery:</label><span>${shipment.estDeliveryDate}</span>
        <label>Mode of Transport:</label><span>${shipment.modeOfTransport}</span>
        <label>Type of Shipment:</label><span>${shipment.typeOfShipment}</span>
        <label>Quantity:</label><span>${shipment.quantity}</span>
      </div>
      <div class="section-title">Payment Details</div>
      <div class="details">
        <label>Amount:</label><span>$${amount}</span>
        <label>Payment Mode:</label><span>${shipment.paymentMode}</span>
        <img src="https://raw.githubusercontent.com/expressdeliveryservices/package-tracker/refs/heads/main/IMG_1860.jpeg" class="payment-img" alt="Payment Icon">
      </div>
      <div class="section-title">Sender Details</div>
      <div class="details">
        <label>Name:</label><span>${shipment.sender.name}</span>
        <label>Address:</label><span>${shipment.sender.address}</span>
      </div>
      <div class="section-title">Receiver Details</div>
      <div class="details">
        <label>Name:</label><span>${shipment.receiver.name}</span>
        <label>Address:</label><span>${shipment.receiver.address}</span>
        <label>Mobile:</label><span>${shipment.receiver.mobile}</span>
      </div>
      <div class="section-title">Authorization</div>
      <div class="details">
        <label>Stamp Date:</label><span>${shipment.officialStampDate}</span>
        ${shipment.officialStamp ? `<label>Stamp:</label><span><img src="${shipment.officialStamp}" class="signature-img" alt="Signature Stamp"></span>` : ''}
      </div>
      <div class="total">Total: $${amount}</div>
      <div class="footer">
        Express Delivery Service | Phone: +1 (941) 207-8626 | Email: Expressdeliveryservice0016@gmail.com<br>
        Issued: September 23, 2025, 10:05 AM WAT
      </div>
    </div>
    </body>
    </html>`;

  // Open print dialog
  const win = window.open('', '_blank');
  if (win) {
    win.document.write(receiptContent);
    win.document.close();
    win.print();
  } else {
    alert('Popup blocked. Please allow popups to print the invoice.');
  }

  // Generate PDF
  const element = document.createElement('div');
  element.innerHTML = receiptContent.replace(/<html>.*<body>/s, '').replace(/<\/body><\/html>/, '');
  document.body.appendChild(element);
  html2pdf()
    .set({
      filename: `Receipt_${shipment.trackingNumber}.pdf`,
      margin: [2, 2, 2, 2],
      html2canvas: { scale: 3, useCORS: true },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    })
    .from(element)
    .save()
    .then(() => {
      document.body.removeChild(element);
    })
    .catch(err => {
      console.error('PDF generation failed:', err);
      alert('Failed to generate PDF. Please try again.');
    });
}

document.addEventListener('DOMContentLoaded', () => {
  initMaps();
  rotateTestimonials();
});
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
