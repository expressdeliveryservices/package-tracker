<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Express Delivery - Track Your Package</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; color: #000; margin: 0; padding: 0; }
    header { background: #1e90ff; color: white; padding: 15px; text-align: center; }
    .container { max-width: 1000px; margin: 20px auto; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .hamburger { display: none; font-size: 24px; cursor: pointer; position: absolute; top: 15px; left: 20px; }
    nav { background: #1e90ff; padding: 10px 0; }
    nav ul { list-style: none; padding: 0; text-align: center; }
    nav ul li { display: inline; margin: 0 15px; }
    nav ul li a { color: white; text-decoration: none; }
    nav ul li a:hover { text-decoration: underline; }
    .section { margin-bottom: 30px; }
    label { font-weight: bold; }
    input { margin: 5px 0; padding: 8px; width: 100%; border-radius: 3px; border: 1px solid #ccc; font-size: 14px; }
    button { background: #1e90ff; color: white; border: none; cursor: pointer; padding: 8px; border-radius: 3px; }
    button:hover { background: #1565c0; }
    #shipmentTracking, #shipmentContent { display: none; }
    .header { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
    .timeline { margin-top: 10px; }
    .timeline-event { display: flex; align-items: center; margin-bottom: 5px; }
    .tick { width: 10px; height: 10px; background: #ccc; border-radius: 50%; margin-right: 10px; }
    .completed .tick { background: #4CAF50; }
    .time, .description { margin-right: 10px; }
    #receiverMap iframe { border: 0; }
    .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); opacity: 0.1; font-size: 40px; color: #ccc; z-index: -1; }
    .company-name { font-size: 24px; text-align: center; margin-bottom: 10px; }
    .logo img { max-width: 100px; height: auto; margin: 0 auto; display: block; }
    .section-title { font-size: 16px; font-weight: bold; margin-top: 15px; }
    .details { display: flex; justify-content: space-between; margin-bottom: 5px; }
    .details label { margin-right: 10px; }
    .signature-img, .payment-img { max-width: 100px; height: auto; margin-top: 5px; }
    .total { text-align: right; font-weight: bold; margin-top: 10px; }
    .footer { font-size: 12px; text-align: center; margin-top: 10px; }
    .print-btn { background: #4CAF50; margin-top: 10px; }
    @media (max-width: 768px) {
      .hamburger { display: block; }
      nav ul { display: none; position: absolute; top: 50px; left: 0; width: 100%; background: #1e90ff; }
      nav ul.active { display: block; }
      nav ul li { display: block; margin: 10px 0; }
    }
  </style>
</head>
<body>
  <header>
    <div class="hamburger" onclick="toggleMenu()">&#9776;</div>
    <h1>Express Delivery</h1>
  </header>

  <nav>
    <ul id="menu">
      <li><a href="#home">Home</a></li>
      <li><a href="#contact">Contact</a></li>
      <!-- Removed "Admin Dashboard" link -->
    </ul>
  </nav>

  <div class="container">
    <div class="section">
      <h2>Track Your Package</h2>
      <label>Enter Tracking Number:</label>
      <input type="text" id="trackingNumber" placeholder="Enter your tracking number">
      <button onclick="trackPackage()">Track Now</button>
    </div>

    <div id="shipmentTracking" class="section"></div>
    <div id="receiverMap" class="section"></div>
    <div id="shipmentContent" class="section"></div>
  </div>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('menu');
      menu.classList.toggle('active');
    }

    function trackPackage() {
      const number = document.getElementById('trackingNumber').value.trim();
      const trackingDiv = document.getElementById('shipmentTracking');
      const contentDiv = document.getElementById('shipmentContent');
      const receiverMap = document.getElementById('receiverMap');

      if (!number) {
        alert('Please enter a tracking number.');
        return;
      }

      trackingDiv.style.display = 'block';
      trackingDiv.innerHTML = '<div class="header">Tracking...</div>';

      let shipments = [];
      try {
        shipments = JSON.parse(localStorage.getItem('shipments') || '[]');
      } catch (e) {
        console.error("Error parsing shipments:", e);
        trackingDiv.innerHTML = '<div class="header">Error retrieving shipment data.</div>';
        return;
      }

      const shipment = shipments.find(s => s.trackingNumber === number);
      if (shipment && shipment.receiver && shipment.receiver.lat && shipment.receiver.lng) {
        const address = encodeURIComponent(shipment.receiver.address || '');
        const mapUrl = `https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d${(1 / Math.cos(shipment.receiver.lat * Math.PI / 180) * 156543.03392 * Math.cos(shipment.receiver.lat * Math.PI / 180) / Math.pow(2, 15))}!2d${shipment.receiver.lng}!3d${shipment.receiver.lat}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0:0x0!2s${address}!5e0!3m2!1sen!2sus!4v1695296400000&markers=color:red%7C${shipment.receiver.lat},${shipment.receiver.lng}`;
        receiverMap.innerHTML = `<a href="https://www.google.com/maps?q=${shipment.receiver.lat},${shipment.receiver.lng}" target="_blank"><iframe src="${mapUrl}" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe></a>`;
      } else {
        receiverMap.innerHTML = `<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2482.614141570908!2d30.4252616!3d60.0348099!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4696378b4b5b0d8d%3A0x7e9f5b8c6e8e8e8e!2sProspekt%20Prosveshcheniya%2C%20104%2C%20Sankt-Peterburg%2C%20Russia!5e0!3m2!1sen!2sus!4v1695296400000" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
      }

      setTimeout(() => {
        if (shipment) {
          trackingDiv.innerHTML = '<div class="header">Tracking Shipment: ' + number + '</div>';
          if (shipment.timeline && shipment.timeline.length > 0) {
            trackingDiv.innerHTML += `<div class="timeline">
              ${shipment.timeline.map(event => `
                <div class="timeline-event ${event.completed ? 'completed' : ''}">
                  <div class="tick"></div>
                  <div class="time">${event.time || 'N/A'}</div>
                  <div class="description">${event.description || 'No description'} <div style="background:#ccc;padding:2px 5px;border-radius:3px;margin-top:3px;">${event.status || 'Unknown'}</div></div>
                </div>
              `).join('')}
            </div>`;
          } else {
            trackingDiv.innerHTML += '<div class="timeline"><div class="timeline-event"><div class="tick"></div><div class="description">No tracking status available.</div></div></div>';
          }
        } else {
          trackingDiv.innerHTML = '<div class="header">Invalid tracking number.</div>';
        }
      }, 5000);

      setTimeout(() => {
        contentDiv.style.display = 'block';
        if (shipment) {
          const companyName = shipment.receipt?.companyName || 'Express Delivery Service';
          const amount = shipment.receipt?.amount || '0.00';
          const signatureStamp = shipment.officialStamp || '';
          contentDiv.innerHTML = `
            <div style="position:relative;">
              <div class="watermark">CERTIFIED TRUE COPY</div>
              <div class="header">
                <div class="company-name">${companyName}</div>
                <div class="logo">
                  <img src="https://raw.githubusercontent.com/expressdeliveryservices/package-tracker/refs/heads/main/IMG_1855.jpeg" alt="Company Logo">
                </div>
              </div>
              <div class="section-title">Shipment</div>
              <div class="details">
                <label>Tracking Number:</label><span>${shipment.trackingNumber}</span>
                <label>Order ID:</label><span>${shipment.orderId || 'N/A'}</span>
                <label>Content:</label><span>${shipment.content || 'Unknown'}</span>
                <label>Origin:</label><span>${shipment.origin || 'Unknown'}</span>
                <label>Destination:</label><span>${shipment.destination || 'Unknown'}</span>
                <label>Est. Delivery:</label><span>${shipment.estDeliveryDate || 'N/A'}</span>
                <label>Transport Mode:</label><span>${shipment.modeOfTransport || 'N/A'}</span>
                <label>Shipment Type:</label><span>${shipment.typeOfShipment || 'N/A'}</span>
                <label>Quantity:</label><span>${shipment.quantity || 'N/A'}</span>
              </div>
              <div class="section-title">Payment</div>
              <div class="details">
                <label>Amount:</label><span>$${amount}</span>
                <label>Payment Mode:</label><span>${shipment.paymentMode || 'N/A'}</span>
                <label>Payment Method:</label><span>${shipment.paymentMethod || 'N/A'}</span>
                <img src="https://raw.githubusercontent.com/expressdeliveryservices/package-tracker/refs/heads/main/IMG_1860.jpeg" class="payment-img" alt="Payment Icon">
              </div>
              <div class="section-title">Sender</div>
              <div class="details">
                <label>Name:</label><span>${shipment.sender.name || 'Unknown'}</span>
                <label>Address:</label><span>${shipment.sender.address || 'Unknown'}</span>
              </div>
              <div class="section-title">Receiver</div>
              <div class="details">
                <label>Name:</label><span>${shipment.receiver.name || 'Unknown'}</span>
                <label>Address:</label><span>${shipment.receiver.address || 'Unknown'}</span>
                <label>Mobile:</label><span>${shipment.receiver.mobile || 'N/A'}</span>
              </div>
              <div class="section-title">Authorization</div>
              <div class="details">
                <label>Signed by:</label><span>${shipment.signedBy || 'N/A'}</span>
                <label>Stamp Date:</label><span>${shipment.officialStampDate || 'N/A'}</span>
                <label>Stamp:</label><span>${signatureStamp ? `<img src="${signatureStamp}" class="signature-img" alt="Signature Stamp">` : 'N/A'}</span>
              </div>
              <div class="total">Total: $${amount}</div>
              <div class="footer">
                Express Delivery Service | Phone: +1 (941) 207-8626 | Email: Expressdeliveryservice0016@gmail.com<br>
                Issued: September 29, 2025, 10:40 PM WAT
              </div>
            </div>
            <button class="print-btn" onclick="printInvoice('${number}')">Print Invoice</button>`;
        } else {
          contentDiv.innerHTML = '<div class="header">No content available for this tracking number.</div>';
        }
      }, 10000);
    }

    function printInvoice(trackingNumber) {
      const contentDiv = document.getElementById('shipmentContent');
      const originalContent = contentDiv.innerHTML;
      contentDiv.innerHTML = originalContent.replace('<button class="print-btn" onclick="printInvoice(\'' + trackingNumber + '\')">Print Invoice</button>', '');
      window.print();
      contentDiv.innerHTML = originalContent; // Restore the button after printing
    }
  </script>
</body>
</html>
